<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content />
    <meta name="author" content />
    <title>Megaparsec | Writing a fast parser</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="../css/megaparsec.css" />
  </head>

  <body>

    <div class="navbar navbar-inverse" role="navigation">
      <div class="container-fluid">
        <div class="navbar-header">
          <a class="navbar-brand" href="../">
            Megaparsec
          </a>
        </div>
        <div class="navbar-right">
          <ul class="nav navbar-nav">
            
            <li>
              <a href="../tutorials.html">Tutorials</a>
            </li>
            
            <li>
              <a href="https://hackage.haskell.org/package/megaparsec">Hackage</a>
            </li>
            
            <li>
              <a href="https://github.com/mrkkrp/megaparsec">GitHub</a>
            </li>
            
          </ul>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="row-fluid">
        <div class="col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2 main">
          <div class="page-header">
            <h1>Writing a fast parser
              
              <br />
              <small>
                Practical recommendations
              </small>
              
            </h1>
            <hr />
            <div class="content">
              
<em>Last updated on September 11, 2016</em>
<hr />


<p>If performance of your Megaparsec parser is worse that you hoped, there may be ways to improve it. This short guide will instruct you what to attempt, but you should always check if you’re getting better results by profiling your parsers (that’s the only way to understand if you are doing the right thing when tuning performance).</p>
<ul>
<li><p>If your parser uses monad stack instead of plain <code>Parsec</code> monad (which is a monad transformer over <code>Identity</code> too, but it’s much more lightweight), make sure you use at least version 5.0 of <code>transformers</code> library, and at least version 5.0 of <code>megaparsec</code>. The both libraries have critical performance improvements in those versions, so you can just get better performance for free.</p></li>
<li><p><code>Parsec</code> monad will be always faster then <code>ParsecT</code>-based monad transformers. Avoid using <code>StateT</code>, <code>WriterT</code>, and other monad transformers unless absolutely necessary. When you have relatively simple monad stack, for example with <code>StateT</code> and nothing more, performance of Megaparsec parser will be on par with Parsec. The more you add to the stack, the slower it will be.</p></li>
<li><p>The most expensive operation is backtracking (you enable it with <code>try</code> and it happens automatically with <code>tokens</code>-based parsers). Avoid building long chains of alternatives where every alternative can go deep into input before failing.</p></li>
<li><p>Inline generously (when it makes sense, of course). You may not believe your eyes when you see how much of a difference inlining can do, especially for short functions.</p></li>
</ul>
<p>The same parser can be written in many ways. Think about your grammar and how parsing happens, when you get some experience with this process, it will be much easier for you to see how to make your parser faster. Sometimes however, making a parser faster will also make code less readable. If performance of your parser is not a bottleneck is the system you are building, consider preferring readability over performance.</p>

            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

  </body>
</html>
